name: Front Service CD # ì›Œí¬í”Œë¡œìš° ì´ë¦„

concurrency: # ë™ì‹œ ì‹¤í–‰ ì œì–´
  group: front-service-deploy # ê·¸ë£¹ ì´ë¦„ì„ ì§€ì •
  cancel-in-progress: false # ì§„í–‰ ì¤‘ì¸ ë°°í¬ê°€ ìˆë‹¤ë©´ ì·¨ì†Œí•˜ì§€ ì•Šê³  ëŒ€ê¸° (ìˆœì°¨ ë°°í¬)

on: # íŠ¸ë¦¬ê±° ì¡°ê±´
  push:
    branches:
      - main
      - dev
      #- feat/CD_lyh # ì„ì‹œ
    paths:
      - "Front/**" # Front í´ë” ë‚´ì˜ íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì‹¤í–‰
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ì‹œì‘í•  ìˆ˜ë„ ìˆìŒ

  # ğŸ‘‡ [ì—¬ê¸° ì¶”ê°€] ì´ ê¶Œí•œ ì„¤ì •ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤!
permissions:
  contents: write
  packages: write # ì´ë¯¸ì§€ë¥¼ GHCRì— í‘¸ì‹œí•œë‹¤ë©´ í•„ìš”
  id-token: write # OIDC í† í° ë°œê¸‰ (AWS ì—°ê²° ë“±) ë° ì„œëª…ìš©
  attestations: write # ë¹Œë“œ ì¦ëª…(Attestation) ì‘ì„±ìš©

jobs:
  releasing: # ì²« ë²ˆì§¸ ë‹¨ê³„: ë¦´ë¦¬ì¦ˆ (ì´ë¯¸ì§€ ë¹Œë“œ)
    uses: ./.github/workflows/release-workflow.yml # ê³µí†µ release ì›Œí¬í”Œë¡œìš° í˜¸ì¶œ
    secrets: # í•„ìš”í•œ ì‹œí¬ë¦¿ ì „ë‹¬
      DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
      DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
      VITE_API_BASE_URL: ${{ secrets.VITE_API_BASE_URL }} # Front ì „ìš© YML ì „ë‹¬
    with: # í•„ìš”í•œ íŒŒë¼ë¯¸í„° ì „ë‹¬
      service-name: front-service
      service-dir: Front
      file-name: Dockerfile
      tag-prefix: "v" # v1.0.0 í˜•ì‹ìœ¼ë¡œ ìƒì„±ë¨


  deploying: # ë‘ ë²ˆì§¸ ë‹¨ê³„: ë°°í¬
    needs: releasing # releasing ë‹¨ê³„ê°€ ì„±ê³µí•´ì•¼ ì‹¤í–‰ë¨
    uses: ./.github/workflows/deploy-workflow.yml # ê³µí†µ deploy ì›Œí¬í”Œë¡œìš° í˜¸ì¶œ
    secrets:
      DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
    with:
      service-name: front-service
      # releasing ë‹¨ê³„ì—ì„œ ë§Œë“¤ì–´ì§„ íƒœê·¸(ë²„ì „)ë¥¼ ë„˜ê²¨ë°›ì•„ ë°°í¬ì— ì‚¬ìš©
      image-tag: ${{ needs.releasing.outputs.tag_name }}
